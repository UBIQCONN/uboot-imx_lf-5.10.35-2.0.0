bootcmd=run bootpre;if test ${checkresult} -ne 0; then run forcebootrescue; fi;if bootm ${loadaddr};then  echo "Boot successful";else run forcebootrescue; fi
bootpre=run setversion;run setmmcpart;run bootinit
bootinit=run mmcargs;run fitload;echo "Will boot ${fitimage} from partition ${mmcpart}"
forcebootrescue=run bootprerescue;bootm ${loadaddr}
bootprerescue=env set version ${stableversion};env set mmcpart 1;run bootinit
console=ttymxc1,115200
fitimage=fw/stable/fitImage
fitload=ext4load mmc ${mmcdev}:${mmcpart} ${loadaddr} ${fitimage}; env set checkresult $?;
installload=mmc dev 1;fatload mmc 1:1 ${scriptaddr} ptt-install-image.scr;source ${scriptaddr}
loadaddr=0x43400000
mmcargs=env set bootargs console=${console} root=${rootdev} ptt_version=${version} mmcpart=${mmcpart}
mmcdev=2
mmcpart=2
rootdev=/dev/ram0
scriptaddr=0x40400000
setversion=env set checkversion ${tryversion};run checkfirmware;if test ${checkresult} -eq 1;then env set version ${tryversion};else env set version ${stableversion}; fi; env set fitimage fw/${version}/fitImage
setmmcpart=env set mmcpart 2;env set checkversion ${version};run checkfirmware;if test ${checkresult} -eq 0;then env set mmcpart 1; fi
checkfirmware=if test -e mmc ${mmcdev}:${mmcpart} fw/${checkversion}/fitImage -a -e mmc ${mmcdev}:${mmcpart} fw/${checkversion}/rootfs -a -e mmc ${mmcdev}:${mmcpart} fw/${checkversion}/apps;then env set checkresult 1; else env set checkresult 0; fi
tryversion=new
stableversion=stable
version=stable
